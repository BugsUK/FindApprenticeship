
@using SFA.Apprenticeships.Web.Common.Framework
@model VacancySearchResponseViewModel

@{
    ViewBag.Title = "SFA Apprenticeships";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string resultMessage;

    if (Model.TotalHits == 0)
    {
        resultMessage = "There are <b class=\"bold-medium\">no</b> Apprenticeships that match your search";
    }
    else if (Model.TotalHits == 1)
    {
        resultMessage = "There is <b class=\"bold-medium\">1</b> Apprenticeship that closely matches your search";
    }
    else
    {
        resultMessage = string.Format("There are <b class=\"bold-medium\">{0}</b> Apprenticeships that closely match your search", Model.TotalHits);
    }
}

<div class="search-results-wrapper grid-wrapper">
    <div class="hgroup">
        <h1 class="heading-xlarge">Search results</h1>
        <p id="vacancy-result-summary">@Html.Raw(resultMessage)</p>
    </div>

    @using (Html.BeginForm("search", "vacancysearch", FormMethod.Get))
    {                      
        <section class="grid grid-1-3">
            <fieldset class="search-filter">
                @Html.ValidationSummary(false)
                <legend class="heading-medium mob-collpanel-trigger">Filter results</legend>
                <div class="mob-collpanel toggle-content--mob">

                    @Html.FormTextFor(m => m.VacancySearch.Keywords, hintText: "")
                    @Html.FormTextFor(m => m.VacancySearch.Location, hintText: "")
                    
                    @if (ViewBag.LocationSearches != null && ViewBag.LocationSearches.Length > 0)
                    {
                        <ul class="list-text list-max-11">
                            <li>Did you mean: </li>
                            @foreach (var locationSearch in ViewBag.LocationSearches)
                            {
                                <li><a href="@Url.Action("results", locationSearch)">@locationSearch.Location</a></li>
                            }
                        </ul>
                    }

                    @* TODO::Create a form control for this. *@
                    <div class="form-group">
                        <label for="loc-within" class="form-label">Within</label>
                        @Html.DropDownListFor(m => m.VacancySearch.WithinDistance, (SelectList) ViewBag.Distances, new {@id = "loc-within", @name = "WithinDistance"})
                    </div>
                    
                    @Html.HiddenFor(m => m.VacancySearch.Latitude, new { @id = "Latitude" })
                    @Html.HiddenFor(m => m.VacancySearch.Longitude, new { @id = "Longitude" })
                    @Html.Hidden("VacancySearch.Hash", Model.VacancySearch.LatLonLocHash())

                    <div class="form-group">
                        <button class="button">Update results</button>
                    </div>
                </div>
            </fieldset>
        
        </section>
        <section class="grid grid-2-3">
            <div id="pagedList">
                @{ Html.RenderPartial("_searchResults", Model); }
            </div>
        </section>
    }
</div>


@section scripts
{
    <script src="~/Content/_assets/js/vendor/jquery-ui-1.10.4.custom.min.js"></script>
    <script src="~/Content/_assets/js/nas/locationAutocomplete.js" type="text/javascript"></script>
    <script src="~/Content/_assets/js/nas/pagination.js" type="text/javascript"></script>
    <script>
        $("#VacancySearch_Location").locationMatch({
            url: '@Url.Action("location", "vacancysearch")',
            longitude: '#Longitude',
            latitude: '#Latitude',
        });

        $(document).ready(function () {
            $("form").submit(function () {
                if ($("#VacancySearch_Location").hasClass("input-validation-error")) {
                    $("#VacancySearch_Location").parent().addClass("input-validation-error");
                }
            });
        });
    </script>
}
