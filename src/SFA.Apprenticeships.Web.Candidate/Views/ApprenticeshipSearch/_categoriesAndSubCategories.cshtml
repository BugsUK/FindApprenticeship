@model ApprenticeshipSearchViewModel

@{
    var divClass = Model.SearchMode == ApprenticeshipSearchMode.Category ? "active" : "";
}
<div class="form-group tabbed-element tab2 @divClass">
    <ul class="copy-16 list-text list-checkradio">
        @foreach (var category in Model.Categories)
        {
            var inputId = string.Format("category{0}", category.CodeName);
            var subCategories = category.SubCategories.ToList();
            var checkedAttr = Model.Category == category.CodeName ? " checked" : "";
            var openAttr = Model.Category == category.CodeName && Model.SubCategories != null && Model.SubCategories.Any() ? "open" : "";
            <li>
                <input @checkedAttr type="radio" name="Category" id="@inputId" value="@category.CodeName"><label for="@inputId">@FullNameFormatter.Format(category.FullName)</label>
                <details @openAttr>
                    <summary class="copy-16">@subCategories.Count sub-categories</summary>
                    <ul class="copy-16 list-text list-checkradio">
                        @foreach (var subCategory in subCategories)
                        {
                            checkedAttr = Model.SubCategories != null && Model.SubCategories.Contains(subCategory.CodeName) ? " checked" : "";
                            var checkboxId = string.Format("subCategory{0}", subCategory.CodeName);
                            var labelText = FullNameFormatter.Format(subCategory.FullName);
                            if (subCategory.Count.HasValue)
                            {
                                labelText = string.Format("{0} ({1})", labelText, subCategory.Count.Value);
                            }
                            <li><input @checkedAttr type="checkbox" name="SubCategories" id="@checkboxId" value="@subCategory.CodeName"><label for="@checkboxId">@labelText</label></li>
                        }
                    </ul>
                </details>
            </li>
        }
    </ul>
</div>