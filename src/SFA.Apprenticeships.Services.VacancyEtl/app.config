<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <appSettings>
    <add key="ConfigurationPath" value="C:\Projects\SFA\Apprenticeships\Configuration\Applications\Shared\Debug\debug.settings.config" />
    <section name="nlog" type="NLog.Config.ConfigSectionHandler, NLog" />
  </appSettings>
  <system.diagnostics>
    <trace>
      <listeners>
        <add type="Microsoft.WindowsAzure.Diagnostics.DiagnosticMonitorTraceListener, Microsoft.WindowsAzure.Diagnostics, Version=2.3.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" name="AzureDiagnostics">
          <filter type=""/>
        </add>
      </listeners>
    </trace>
  </system.diagnostics>
  <startup>
    <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.5.1"/>
  </startup>

  <nlog throwExceptions="true" internalLogToConsole="true" internalLogLevel="Debug" autoReload="true" internalLogFile="c:\NLog\Internal.log" xmlns="http://www.nlog-project.org/schemas/NLog.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <extensions>
      <add assembly="SFA.Apprenticeships.Common" />
    </extensions>
    <variable name="brief" value="${longdate} | ${level} | ${logger} | ${message} | ${onexception: EXCEPTION\: ${exception:format=tostring}}" />
    <variable name="verbose" value="${longdate} | ${machinename} | ${processname} | ${processid} | ${threadid} | ${level} | ${logger} | ${message} | ${onexception: EXCEPTION\: ${exception:format=tostring}}" />
    <targets async="true">
      <target name="fileLog" xsi:type="File" layout="${verbose}" fileName="${basedir}/Debug.Web.log" archiveFileName="${basedir}/Logging.Web.{#####}.log" archiveAboveSize="10485760" concurrentWrites="false" maxArchiveFiles="50" archiveNumbering="Rolling" />
      <target name="rabbit" 
              xsi:type="RabbitMQTarget" 
              RabbitHost="Dev"
		          QueueName="Logging"
		          ExchangeName="Logging"
		          ExchangeType="topic"
		          RoutingKey="SFA.Apprenticeships.{0}"
		          AppId="SFA.Apprenticeships.App">
        <layout xsi:type="JsonLayout">
          <property name="date" layout="${longdate}" />
          <property name="level" layout="${level:upperCase=true}" />
          <property name="logger" layout="${logger}" />
          <property name="machinename" layout="${machinename}" />
          <property name="processname" layout="${processname}" />
          <property name="message" layout="${message}" />
          <property name="exception" layout="${onexception:${exception:format=tostring}}" />
          <property name="stacktrace" layout="${onexception:${stacktrace:tostring}}" />
        </layout>
      </target>
    </targets>
    <rules>
      <logger name="*" minlevel="Debug" writeTo="fileLog" />
      <logger name="*" minlevel="Info" writeTo="rabbit" />
    </rules>
  </nlog>


</configuration>
