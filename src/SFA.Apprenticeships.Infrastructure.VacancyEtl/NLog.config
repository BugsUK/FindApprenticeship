<?xml version="1.0" encoding="utf-8" ?>
<nlog throwExceptions="true" internalLogToConsole="true" internalLogLevel="Debug" autoReload="true" xmlns="http://www.nlog-project.org/schemas/NLog.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <extensions>
    <add assembly="SFA.Apprenticeships.Infrastructure.Logging" />
  </extensions>
  <targets async="true">
    <target xsi:type="FallbackGroup" name="fallbacklogger" returnToFirstOnSuccess="true">
      <target name="rabbit"
              xsi:type="RabbitMQTarget"
              RabbitHost="Logging"
              QueueName="SFA.Logging"
              ExchangeName="SFA.Logging"
              ExchangeType="topic"
              RoutingKey="SFA.Apprenticeships.Infrastructure.VacancyEtl.{0}"
              AppId="SFA.Apprenticeships.Infrastructure.VacancyEtl">
        <layout xsi:type="JsonLayout">
          <property name="application" layout="SFA.Apprenticeships.Infrastructure.VacancyEtl" />
          <property name="date" layout="${longdate}" />
          <property name="level" layout="${level:upperCase=true}" />
          <property name="logger" layout="${logger}" />
          <property name="machinename" layout="${machinename}" />
          <property name="processname" layout="${processname}" />
          <property name="message" layout="${message}" />
          <property name="exception" layout="${onexception:${exception:format=tostring}}" />
          <property name="stacktrace" layout="${onexception:${stacktrace:tostring}}" />
        </layout>
      </target>
      <target xsi:type="Mail"
                subject="NAS Error: ${message} (${level})"
                body="${message}"
                from="donotreply@apprenticeships.gov.uk"
                to="Mark Gwilliam &lt;mark.gwilliam@valtech.co.uk&gt;; Vicenc Garcia-Altes &lt;Vicenc.Garcia-Altes@valtech.co.uk&gt;; Krister Bone &lt;Krister.Bone@valtech.co.uk&gt;; Alan Gorton &lt;Alan.Gorton@valtech.co.uk&gt;; Christopher Monney &lt;Christopher.Monney@valtech.co.uk&gt;; James Jeffrey &lt;james.jeffrey@valtech.co.uk&gt;; Akbar Zamir &lt;akbar.zamir@valtech.co.uk&gt;"
                useSystemNetMailSettings="true"
                replaceNewlineWithBrTagInHtml="true"
                html="true"
                layout="SFA.Apprenticeships.Web.Candidate${newline}${newline}User: ${mdc:userId}${newline}Session: ${mdc:sessionId}${newline}Logged date: ${longdate}${newline}Level: ${level:upperCase=true}${newline}Logger: ${logger}${newline}Machine name: ${machinename}${newline}Process name: ${processname}${newline}Message: ${message}${newline}${onexception:${exception:format=tostring}}${newline}${onexception:${stacktrace:tostring}}">

      </target>
    </target>
  </targets>
  <rules>
    <logger name="*" minlevel="Debug" writeTo="fallbacklogger" />
  </rules>
</nlog>